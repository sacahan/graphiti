---
name: Integrate factory into main Graphiti class
status: open
created: 2025-09-05T10:40:37Z
updated: 2025-09-05T10:40:37Z
github: https://github.com/sacahan/graphiti/issues/5
depends_on: [002, 003]
parallel: false
conflicts_with: []
---

# Task: Integrate factory into main Graphiti class

## Description

Refactor the main `Graphiti` class to use the new `DriverFactory` instead of hardcoded Neo4j driver instantiation. This enables database backend switching via environment variables while maintaining full backward compatibility.

## Acceptance Criteria

- [ ] Main `Graphiti` class uses `DriverFactory` for driver instantiation
- [ ] Backward compatibility maintained (existing code works unchanged)
- [ ] Environment variable `GRAPHITI_DB_TYPE=falkordb` switches to FalkorDB
- [ ] Default behavior remains Neo4j when no `GRAPHITI_DB_TYPE` specified
- [ ] Clear error messages for configuration issues
- [ ] All existing Graphiti SDK methods work with both backends
- [ ] Configuration validation happens at initialization time

## Technical Details

### Implementation Approach

- Modify `Graphiti.__init__()` to use `DriverFactory.create_driver()`
- Remove hardcoded Neo4j driver instantiation
- Pass through configuration parameters to factory
- Maintain existing constructor signature for backward compatibility
- Add validation and error handling for unsupported configurations

### Key Changes in `graphiti_core/graphiti.py`

```python
class Graphiti:
    def __init__(self, uri=None, user=None, password=None, database=None, **kwargs):
        # Use factory instead of hardcoded Neo4j driver
        self.driver = DriverFactory.create_driver({
            'uri': uri,
            'user': user,
            'password': password,
            'database': database,
            **kwargs
        })
```

### Code Locations/Files Affected

- Update: `graphiti_core/graphiti.py`
- Update: Any initialization code in MCP server
- Tests: Update existing integration tests
- Tests: Add new tests for backend switching

## Dependencies

- [ ] Task 002 completed (DriverFactory implemented)
- [ ] Task 003 completed (FalkorDB configuration ready)
- [ ] Understanding of current Graphiti initialization patterns

## Effort Estimate

- **Size**: M
- **Hours**: 6-8 hours
- **Parallel**: false (requires both factory and configuration)

## Definition of Done

- [ ] Main Graphiti class refactored to use DriverFactory
- [ ] Backward compatibility verified with existing tests
- [ ] Environment variable switching tested and working
- [ ] Error handling provides clear messages for misconfigurations
- [ ] All existing integration tests pass with both backends
- [ ] Code passes linting and type checking
- [ ] No performance regression in initialization time
