---
name: Implement database factory pattern
status: open
created: 2025-09-05T10:40:37Z
updated: 2025-09-06T02:09:10Z
github: https://github.com/sacahan/graphiti/issues/3
depends_on: [001]
parallel: false
conflicts_with: [003]
---

# Task: Implement database factory pattern

## Description

Create a `DriverFactory` class in `graphiti_core/driver/` that handles database backend selection based on configuration. This factory will instantiate the appropriate driver (Neo4j or FalkorDB) based on environment variables or explicit configuration.

## Acceptance Criteria

- [ ] `DriverFactory` class created in `graphiti_core/driver/factory.py`
- [ ] Factory supports both Neo4j and FalkorDB driver instantiation
- [ ] Environment variable `GRAPHITI_DB_TYPE` controls backend selection
- [ ] Default behavior maintains Neo4j for backward compatibility
- [ ] Clear error messages for invalid database type configurations
- [ ] Factory validates driver-specific configuration before instantiation
- [ ] Unit tests cover all factory logic and error cases

## Technical Details

### Implementation Approach

- Create `DriverFactory` class with static `create_driver()` method
- Use environment variable parsing to determine backend type
- Validate configuration parameters for selected backend
- Return appropriate driver instance with validated configuration
- Implement clear error handling for misconfiguration scenarios

### Key Components

```python
class DriverFactory:
    @staticmethod
    def create_driver(config: Optional[dict] = None) -> BaseGraphDriver:
        # Parse GRAPHITI_DB_TYPE environment variable
        # Validate configuration for selected backend
        # Instantiate and return appropriate driver
```

### Code Locations/Files Affected

- New file: `graphiti_core/driver/factory.py`
- Update: `graphiti_core/driver/__init__.py` (export factory)
- Tests: `tests/driver/test_factory.py`

## Dependencies

- [ ] Task 001 completed (audit identifies current driver usage patterns)
- [ ] Existing `BaseGraphDriver` interface understood
- [ ] FalkorDB driver configuration requirements documented

## Effort Estimate

- **Size**: M
- **Hours**: 6-8 hours
- **Parallel**: false (depends on audit findings)

## Definition of Done

- [ ] `DriverFactory` class implemented and tested
- [ ] Environment variable parsing working correctly
- [ ] Both Neo4j and FalkorDB drivers can be instantiated via factory
- [ ] Configuration validation provides helpful error messages
- [ ] Unit tests achieve >90% coverage
- [ ] Code passes linting and type checking
- [ ] Documentation includes factory usage examples
